{"ast":null,"code":"import _classCallCheck from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/opt/lampp/htdocs/reactApp/React_16.x/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/opt/lampp/htdocs/reactApp/React_16.x/src/common/graphs/d3/components/D3Map.js\";\nimport React from \"react\";\nimport { findDOMNode } from \"react-dom\";\nimport { config } from \"../../../../config/config\";\n\nvar $script = require(\"scriptjs\");\n\nrequire(\"./D3Map.css\");\n\nvar d3, topojson; // we load them from cdn\n\nvar D3Map =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(D3Map, _React$Component);\n\n  function D3Map(props) {\n    var _this;\n\n    _classCallCheck(this, D3Map);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(D3Map).call(this, props));\n\n    _this.d3Init = function () {\n      d3.select(window).on(\"resize\", _this.throttle.bind(_assertThisInitialized(_assertThisInitialized(_this))));\n      _this.zoom = d3.zoom() //.extent([1,9])\n      .scaleExtent([1, 20]).on(\"zoom\", _this.move.bind(_assertThisInitialized(_assertThisInitialized(_this))));\n      _this.container = d3.select(_this.getContainer());\n      _this.width = _this.getContainer().offsetWidth;\n      _this.height = Math.max(_this.width / 2, 300); //offsets for tooltips\n\n      _this.offsetL = _this.container.offsetLeft + 20;\n      _this.offsetT = _this.container.offsetTop + 10; //var graticule = d3.geo.graticule();\n\n      _this.graticule = d3.geoGraticule();\n      _this.tooltip = _this.container.append(\"div\").attr(\"class\", \"tooltip hidden\");\n\n      _this.setup(_this.width, _this.height);\n\n      d3.json(config.apiRootUrl + \"/graphs/d3/world-topo-min.json\", function (err, world) {\n        world.objects.countries.geometries = world.objects.countries.geometries.map(function (it) {\n          it.properties.value = _this.data[it.properties.name];\n          return it;\n        });\n        _this.countries = topojson.feature(world, world.objects.countries).features;\n        var maxVal = Object.keys(_this.data).reduce(function (current, next) {\n          return current >= _this.data[next] ? current : _this.data[next];\n        }, 0);\n        _this.color = d3.scaleLinear().domain([0, maxVal]).range([0, 100]) // .interpolate(d3.interpolateRgb.gamma(2.2)(\"purple\", \"orange\"))\n        .range([d3.color(\"rgba(0, 113, 164, 0.6)\"), d3.color(\"rgba(0, 113, 164, 1)\")]).nice(100);\n\n        _this.draw();\n\n        _this.initialized = true;\n      });\n    };\n\n    _this.setup = function (width, height) {\n      //projection = d3.geo.mercator()\n      _this.projection = d3.geoMercator().translate([width / 2, height / 2]).scale(width / 2 / Math.PI); //path = d3.geo.path().projection(projection);\n\n      _this.path = d3.geoPath().projection(_this.projection);\n      _this.svg = _this.container.append(\"svg\").attr(\"width\", width).attr(\"height\", height).call(_this.zoom).on(\"click\", _this.click.bind(_assertThisInitialized(_assertThisInitialized(_this))));\n      _this.g = _this.svg.append(\"g\");\n\n      _this.zoom.scaleBy(_this.svg.transition().duration(750), 0.9);\n\n      _this.zoom.translateBy(_this.svg.transition().duration(750), 0, 20);\n    };\n\n    _this.handleMouseOver = function (country) {\n      var mouse = d3.mouse(_this.svg.node()).map(function (d) {\n        return parseInt(d, 10);\n      });\n\n      _this.tooltip.classed(\"hidden\", false).attr(\"style\", \"left:\" + (mouse[0] + _this.offsetL) + \"px;top:\" + (mouse[1] + _this.offsetT) + \"px\").html(country.properties.name);\n    };\n\n    _this.handleMouseOut = function () {\n      _this.tooltip.classed(\"hidden\", true);\n    };\n\n    _this.draw = function () {\n      var country = _this.g.selectAll(\".country\").data(_this.countries);\n\n      country.enter().insert(\"path\").attr(\"class\", \"country\").attr(\"d\", _this.path).attr(\"id\", function (d, i) {\n        return d.id;\n      }).attr(\"title\", function (d, i) {\n        return d.properties.name;\n      }).style(\"stroke\", d3.color(\"white\")).style(\"fill\", function (d, i) {\n        return !d.properties.value ? d3.color(\"rgba(0, 113, 164, 0.0)\") : _this.color(d.properties.value);\n      }).style(\"stroke-width\", \"0.5\").on(\"mouseover\", _this.handleMouseOver.bind(_assertThisInitialized(_assertThisInitialized(_this)))).on(\"mouseout\", _this.handleMouseOut.bind(_assertThisInitialized(_assertThisInitialized(_this)))); //tooltips\n\n      /*\n       d3.select(\"#container svg path\")\n       .on(\"mousemove\", function(d,i) {\n       console.log(d);\n       var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );\n        tooltip.classed(\"hidden\", false)\n       .attr(\"style\", \"left:\"+(mouse[0]+offsetL)+\"px;top:\"+(mouse[1]+offsetT)+\"px\")\n       .html(d.properties.name);\n        })\n       .on(\"mouseout\",  function(d,i) {\n       tooltip.classed(\"hidden\", true);\n       }); */\n    };\n\n    _this.redraw = function () {\n      _this.width = _this.getContainer().offsetWidth;\n      _this.height = Math.max(_this.width / 2, 300);\n      d3.select(\"svg\").remove();\n\n      _this.setup(_this.width, _this.height);\n\n      _this.draw();\n    };\n\n    _this.move = function () {\n      //const t = d3.event.translate;\n      var t = [d3.event.transform.x, d3.event.transform.y]; //const s = d3.event.scale;\n\n      var s = d3.event.transform.k; // const zscale = s;\n\n      var h = _this.height / 4;\n      t[0] = Math.min(_this.width / _this.height * (s - 1), Math.max(_this.width * (1 - s), t[0]));\n      t[1] = Math.min(h * (s - 1) + h * s, Math.max(_this.height * (1 - s) - h * s, t[1])); //zoom.translateBy(t);\n\n      _this.g.attr(\"transform\", \"translate(\" + t + \")scale(\" + s + \")\"); //adjust the country hover stroke width based on zoom level\n      // d3.selectAll(\".country\").style(\"stroke-width\", 1.5 / s);\n\n    };\n\n    _this.zoomIn = function () {\n      _this.zoom.scaleBy(_this.svg.transition().duration(750), 1.3);\n    };\n\n    _this.zoomOut = function () {\n      _this.zoom.scaleBy(_this.svg.transition().duration(750), 0.7);\n    };\n\n    _this.throttle = function () {\n      window.clearTimeout(_this.throttleTimer);\n      _this.throttleTimer = window.setTimeout(function () {\n        _this.redraw();\n      }, 200);\n    };\n\n    _this.click = function () {\n      var latlon = _this.projection.invert(d3.mouse(_this.svg.node()));\n\n      console.log(latlon);\n    };\n\n    _this.addpoint = function (lon, lat, text) {\n      var gpoint = _this.g.append(\"g\").attr(\"class\", \"gpoint\");\n\n      var x = _this.projection([lon, lat])[0];\n\n      var y = _this.projection([lon, lat])[1];\n\n      gpoint.append(\"svg:circle\").attr(\"cx\", x).attr(\"cy\", y).attr(\"class\", \"point\").attr(\"r\", 1.5); //conditional in case a point has no associated text\n\n      if (text.length > 0) {\n        gpoint.append(\"text\").attr(\"x\", x + 2).attr(\"y\", y + 2).attr(\"class\", \"text\").text(text);\n      }\n    };\n\n    _this.getContainer = function () {\n      if (!_this.cachedContainer) {\n        _this.cachedContainer = findDOMNode(_assertThisInitialized(_assertThisInitialized(_this))).querySelector(\".d3-map\");\n      }\n\n      return _this.cachedContainer;\n    };\n\n    _this.data = _this.props.data;\n    return _this;\n  }\n\n  _createClass(D3Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      $script([\"https://d3js.org/d3.v4.min.js\", \"https://d3js.org/topojson.v1.min.js\"], function () {\n        d3 = window[\"d3\"];\n        topojson = window[\"topojson\"];\n\n        _this2.d3Init();\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: this.props.className + \" d3-map-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"d3-zoomin\",\n        onClick: this.zoomIn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fa fa-plus\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"d3-zoomout\",\n        onClick: this.zoomOut,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fa fa-minus\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"d3-map\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return D3Map;\n}(React.Component);\n\nexport { D3Map as default };","map":{"version":3,"sources":["/opt/lampp/htdocs/reactApp/React_16.x/src/common/graphs/d3/components/D3Map.js"],"names":["React","findDOMNode","config","$script","require","d3","topojson","D3Map","props","d3Init","select","window","on","throttle","bind","zoom","scaleExtent","move","container","getContainer","width","offsetWidth","height","Math","max","offsetL","offsetLeft","offsetT","offsetTop","graticule","geoGraticule","tooltip","append","attr","setup","json","apiRootUrl","err","world","objects","countries","geometries","map","it","properties","value","data","name","feature","features","maxVal","Object","keys","reduce","current","next","color","scaleLinear","domain","range","nice","draw","initialized","projection","geoMercator","translate","scale","PI","path","geoPath","svg","call","click","g","scaleBy","transition","duration","translateBy","handleMouseOver","country","mouse","node","d","parseInt","classed","html","handleMouseOut","selectAll","enter","insert","i","id","style","redraw","remove","t","event","transform","x","y","s","k","h","min","zoomIn","zoomOut","clearTimeout","throttleTimer","setTimeout","latlon","invert","console","log","addpoint","lon","lat","text","gpoint","length","cachedContainer","querySelector","className","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\n\nimport { findDOMNode } from \"react-dom\";\n\nimport { config } from \"../../../../config/config\";\n\nconst $script = require(\"scriptjs\");\n\nrequire(\"./D3Map.css\");\nlet d3, topojson; // we load them from cdn\n\nexport default class D3Map extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.data = this.props.data;\n  }\n\n  componentDidMount() {\n    $script(\n      [\"https://d3js.org/d3.v4.min.js\", \"https://d3js.org/topojson.v1.min.js\"],\n      () => {\n        d3 = window[\"d3\"];\n        topojson = window[\"topojson\"];\n        this.d3Init();\n      }\n    );\n  }\n\n  d3Init = () => {\n    d3.select(window).on(\"resize\", this.throttle.bind(this));\n\n    this.zoom = d3\n      .zoom()\n      //.extent([1,9])\n      .scaleExtent([1, 20])\n      .on(\"zoom\", this.move.bind(this));\n\n    this.container = d3.select(this.getContainer());\n    this.width = this.getContainer().offsetWidth;\n    this.height = Math.max(this.width / 2, 300);\n\n    //offsets for tooltips\n    this.offsetL = this.container.offsetLeft + 20;\n    this.offsetT = this.container.offsetTop + 10;\n\n    //var graticule = d3.geo.graticule();\n    this.graticule = d3.geoGraticule();\n\n    this.tooltip = this.container.append(\"div\").attr(\"class\", \"tooltip hidden\");\n\n    this.setup(this.width, this.height);\n\n    d3.json(\n      config.apiRootUrl + \"/graphs/d3/world-topo-min.json\",\n      (err, world) => {\n        world.objects.countries.geometries = world.objects.countries.geometries.map(\n          it => {\n            it.properties.value = this.data[it.properties.name];\n            return it;\n          }\n        );\n        this.countries = topojson.feature(\n          world,\n          world.objects.countries\n        ).features;\n\n        const maxVal = Object.keys(this.data).reduce((current, next) => {\n          return current >= this.data[next] ? current : this.data[next];\n        }, 0);\n\n        this.color = d3\n          .scaleLinear()\n          .domain([0, maxVal])\n          .range([0, 100])\n          // .interpolate(d3.interpolateRgb.gamma(2.2)(\"purple\", \"orange\"))\n          .range([\n            d3.color(\"rgba(0, 113, 164, 0.6)\"),\n            d3.color(\"rgba(0, 113, 164, 1)\")\n          ])\n          .nice(100);\n\n        this.draw();\n        this.initialized = true;\n      }\n    );\n  };\n\n  setup = (width, height) => {\n    //projection = d3.geo.mercator()\n    this.projection = d3\n      .geoMercator()\n      .translate([width / 2, height / 2])\n      .scale(width / 2 / Math.PI);\n\n    //path = d3.geo.path().projection(projection);\n    this.path = d3.geoPath().projection(this.projection);\n\n    this.svg = this.container\n      .append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .call(this.zoom)\n      .on(\"click\", this.click.bind(this));\n\n    this.g = this.svg.append(\"g\");\n\n    this.zoom.scaleBy(this.svg.transition().duration(750), 0.9);\n    this.zoom.translateBy(this.svg.transition().duration(750), 0, 20);\n  };\n\n  handleMouseOver = country => {\n    const mouse = d3.mouse(this.svg.node()).map(d => {\n      return parseInt(d, 10);\n    });\n\n    this.tooltip\n      .classed(\"hidden\", false)\n      .attr(\n        \"style\",\n        \"left:\" +\n          (mouse[0] + this.offsetL) +\n          \"px;top:\" +\n          (mouse[1] + this.offsetT) +\n          \"px\"\n      )\n      .html(country.properties.name);\n  };\n\n  handleMouseOut = () => {\n    this.tooltip.classed(\"hidden\", true);\n  };\n\n  draw = () => {\n\n    const country = this.g.selectAll(\".country\").data(this.countries);\n\n    country\n      .enter()\n      .insert(\"path\")\n      .attr(\"class\", \"country\")\n      .attr(\"d\", this.path)\n      .attr(\"id\", (d, i) => {\n        return d.id;\n      })\n      .attr(\"title\", (d, i) => {\n        return d.properties.name;\n      })\n      .style(\"stroke\", d3.color(\"white\"))\n      .style(\"fill\", (d, i) => {\n        return !d.properties.value\n          ? d3.color(\"rgba(0, 113, 164, 0.0)\")\n          : this.color(d.properties.value);\n      })\n      .style(\"stroke-width\", \"0.5\")\n      .on(\"mouseover\", this.handleMouseOver.bind(this))\n      .on(\"mouseout\", this.handleMouseOut.bind(this));\n\n    //tooltips\n    /*\n     d3.select(\"#container svg path\")\n     .on(\"mousemove\", function(d,i) {\n     console.log(d);\n     var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );\n\n     tooltip.classed(\"hidden\", false)\n     .attr(\"style\", \"left:\"+(mouse[0]+offsetL)+\"px;top:\"+(mouse[1]+offsetT)+\"px\")\n     .html(d.properties.name);\n\n     })\n     .on(\"mouseout\",  function(d,i) {\n     tooltip.classed(\"hidden\", true);\n     }); */\n  };\n\n  redraw = () => {\n    this.width = this.getContainer().offsetWidth;\n    this.height = Math.max(this.width / 2, 300);\n    d3.select(\"svg\").remove();\n    this.setup(this.width, this.height);\n    this.draw();\n  };\n\n  move = () => {\n    //const t = d3.event.translate;\n    const t = [d3.event.transform.x, d3.event.transform.y];\n    //const s = d3.event.scale;\n    const s = d3.event.transform.k;\n    // const zscale = s;\n    const h = this.height / 4;\n\n    t[0] = Math.min(\n      (this.width / this.height) * (s - 1),\n      Math.max(this.width * (1 - s), t[0])\n    );\n\n    t[1] = Math.min(\n      h * (s - 1) + h * s,\n      Math.max(this.height * (1 - s) - h * s, t[1])\n    );\n\n    //zoom.translateBy(t);\n    this.g.attr(\"transform\", \"translate(\" + t + \")scale(\" + s + \")\");\n\n    //adjust the country hover stroke width based on zoom level\n    // d3.selectAll(\".country\").style(\"stroke-width\", 1.5 / s);\n  };\n\n  zoomIn = () => {\n    this.zoom.scaleBy(this.svg.transition().duration(750), 1.3);\n  };\n\n  zoomOut = () => {\n    this.zoom.scaleBy(this.svg.transition().duration(750), 0.7);\n  };\n\n  throttleTimer;\n\n  throttle = () => {\n    window.clearTimeout(this.throttleTimer);\n    this.throttleTimer = window.setTimeout(() => {\n      this.redraw();\n    }, 200);\n  };\n\n  //geo translation on mouse click in map\n  click = () => {\n    const latlon = this.projection.invert(d3.mouse(this.svg.node()));\n    console.log(latlon);\n  };\n\n  //function to add points and text to the map (used in plotting capitals)\n  addpoint = (lon, lat, text) => {\n    const gpoint = this.g.append(\"g\").attr(\"class\", \"gpoint\");\n    const x = this.projection([lon, lat])[0];\n    const y = this.projection([lon, lat])[1];\n\n    gpoint\n      .append(\"svg:circle\")\n      .attr(\"cx\", x)\n      .attr(\"cy\", y)\n      .attr(\"class\", \"point\")\n      .attr(\"r\", 1.5);\n\n    //conditional in case a point has no associated text\n    if (text.length > 0) {\n      gpoint\n        .append(\"text\")\n        .attr(\"x\", x + 2)\n        .attr(\"y\", y + 2)\n        .attr(\"class\", \"text\")\n        .text(text);\n    }\n  };\n\n  getContainer = () => {\n    if (!this.cachedContainer) {\n      this.cachedContainer = findDOMNode(this).querySelector(\".d3-map\");\n    }\n    return this.cachedContainer;\n  };\n\n  render() {\n    return (\n      <div className={this.props.className + \" d3-map-container\"}>\n        <div className=\"d3-zoomin\" onClick={this.zoomIn}>\n          <i className=\"fa fa-plus\" />\n        </div>\n        <div className=\"d3-zoomout\" onClick={this.zoomOut}>\n          <i className=\"fa fa-minus\" />\n        </div>\n        <div className=\"d3-map\" />\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}