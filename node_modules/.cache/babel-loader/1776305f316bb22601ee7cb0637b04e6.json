{"ast":null,"code":"/**\n * @license\n * Copyright 2013 David Eberlein (david.eberlein@ch.sauter-bc.com)\n * MIT-licensed (http://opensource.org/licenses/MIT)\n */\n\n/**\n * @fileoverview DataHandler implementation for the custom bars option.\n * @author David Eberlein (david.eberlein@ch.sauter-bc.com)\n */\n\n/*global Dygraph:false */\n\"use strict\";\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nvar _bars = require('./bars');\n\nvar _bars2 = _interopRequireDefault(_bars);\n/**\n * @constructor\n * @extends Dygraph.DataHandlers.BarsHandler\n */\n\n\nvar CustomBarsHandler = function CustomBarsHandler() {};\n\nCustomBarsHandler.prototype = new _bars2['default']();\n/** @inheritDoc */\n\nCustomBarsHandler.prototype.extractSeries = function (rawData, i, options) {\n  // TODO(danvk): pre-allocate series here.\n  var series = [];\n  var x, y, point;\n  var logScale = options.get('logscale');\n\n  for (var j = 0; j < rawData.length; j++) {\n    x = rawData[j][0];\n    point = rawData[j][i];\n\n    if (logScale && point !== null) {\n      // On the log scale, points less than zero do not exist.\n      // This will create a gap in the chart.\n      if (point[0] <= 0 || point[1] <= 0 || point[2] <= 0) {\n        point = null;\n      }\n    } // Extract to the unified data format.\n\n\n    if (point !== null) {\n      y = point[1];\n\n      if (y !== null && !isNaN(y)) {\n        series.push([x, y, [point[0], point[2]]]);\n      } else {\n        series.push([x, y, [y, y]]);\n      }\n    } else {\n      series.push([x, null, [null, null]]);\n    }\n  }\n\n  return series;\n};\n/** @inheritDoc */\n\n\nCustomBarsHandler.prototype.rollingAverage = function (originalData, rollPeriod, options) {\n  rollPeriod = Math.min(rollPeriod, originalData.length);\n  var rollingData = [];\n  var y, low, high, mid, count, i, extremes;\n  low = 0;\n  mid = 0;\n  high = 0;\n  count = 0;\n\n  for (i = 0; i < originalData.length; i++) {\n    y = originalData[i][1];\n    extremes = originalData[i][2];\n    rollingData[i] = originalData[i];\n\n    if (y !== null && !isNaN(y)) {\n      low += extremes[0];\n      mid += y;\n      high += extremes[1];\n      count += 1;\n    }\n\n    if (i - rollPeriod >= 0) {\n      var prev = originalData[i - rollPeriod];\n\n      if (prev[1] !== null && !isNaN(prev[1])) {\n        low -= prev[2][0];\n        mid -= prev[1];\n        high -= prev[2][1];\n        count -= 1;\n      }\n    }\n\n    if (count) {\n      rollingData[i] = [originalData[i][0], 1.0 * mid / count, [1.0 * low / count, 1.0 * high / count]];\n    } else {\n      rollingData[i] = [originalData[i][0], null, [null, null]];\n    }\n  }\n\n  return rollingData;\n};\n\nexports['default'] = CustomBarsHandler;\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}